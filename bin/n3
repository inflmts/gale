#!/usr/bin/env bash
# nnn wrapper

declare -A bookmarks plugins

# bookmark <key> <path>
#
#   Bind a bookmark key.
#
bookmark() {
  bookmarks["$1"]="$2"
}

# plugin <key> <path>
#
#   Bind a plugin key.
#
plugin() {
  plugins["$1"]="$2"
}

# add bookmarks
bookmark T /tmp
bookmark C "${XDG_CONFIG_HOME:-$HOME/.config}"
bookmark D "${XDG_DATA_HOME:-$HOME/.local/share}"
bookmark S "${XDG_STATE_HOME:-$HOME/.local/state}"
bookmark X "${XDG_CACHE_HOME:-$HOME/.cache}"
bookmark R "${XDG_RUNTIME_DIR}"
bookmark M /run/media/"$USER"

# arguments passed to nnn
N3_ARGS=( -dHT v -Ux )
# -d    show details
# -H    show hidden files
# -T v  use version sort (ie. put dotfiles first)
# -U    show user/group names in status bar
# -x    show xterm title

# source local configuration from the bash script $XDG_CONFIG_HOME/gale/n3rc
# (defaults to ~/.config/gale/n3rc)
config_file="${XDG_CONFIG_HOME:-$HOME/.config}/gale/n3rc"
[ -s "$config_file" ] && . "$config_file"

# generate $NNN_BMS
NNN_BMS=
for key in "${!bookmarks[@]}"; do
  NNN_BMS="${NNN_BMS}${key}:${bookmarks[$key]};"
done
export NNN_BMS="${NNN_BMS%;}"

# generate $NNN_PLUG
NNN_PLUG=
for key in "${!plugins[@]}"; do
  NNN_PLUG="${NNN_PLUG}${key}:${plugins[$key]};"
done
export NNN_PLUG="${NNN_PLUG%;}"

exec nnn "${N3_ARGS[@]}" "$@"
