#!/bin/sh
# corecon command runner

set -e

usage() {
  cat <<EOF
usage: corecon <command> <args>...
commands:
  c, config
  b, build
  a, apply
  gen-ninja
  update-vim-plug
EOF
}

if [ "$#" -eq 0 ]; then
  usage >&2
  exit 1
fi

cmd=$1
shift

case "$cmd" in
  c|config) exec ~/.local/corecon/lib/config "$@" ;;
  b|build) exec ~/.local/corecon/lib/build "$@" ;;
  a|apply) exec ~/.local/corecon/lib/apply "$@" ;;

  gen-ninja)
    datadir="${XDG_DATA_HOME:-$HOME/.local/share}/corecon"
    mkdir -p "$datadir"
    ~/.local/corecon/lib/gen-ninja "$datadir/apply.ninja"
    ;;

  update-vim-plug)
    exec ~/.local/corecon/lib/get-vim-plug "$@"
    ;;

  help|--help)
    usage
    exit 0
    ;;

  *)
    printf >&2 'error: unrecognized command: %s\n' "$cmd"
    exit 1
    ;;
esac
