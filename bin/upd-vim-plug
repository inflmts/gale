#!/bin/sh
# download and install vim-plug with curl
#
# This file is part of Gale.

echo() { printf '%s\n' "$*"; }
diag() { printf >&2 '%s\n' "$*"; }
warn() { printf >&2 'warning: %s\n' "$*"; }
err() { printf >&2 'error: %s\n' "$*"; }
die() { printf >&2 'error: %s\n' "$*"; exit 1; }

usage() {
  cat <<END
download and install vim-plug

usage: upd-vim-plug [<option>...]
options:
  --needed  only download as needed
END
}

needed=

for OPT; do
  case "$OPT" in
    --needed) needed=1 ;;
    *) die "invalid option: $OPT" ;;
  esac
done

file="$HOME/.vim/autoload/plug.vim"

# if --needed was passed and plug.vim is installed, quit now
if [ "$needed" ] && [ -f "$file" ]; then
  exit 0
fi

echo 'Updating vim-plug...'
if curl -Lfo "$file.new" --create-dirs \
  https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
then
  # if the download succeeded,
  # overwrite plug.vim with the downloaded file
  mv "$file.new" "$file"
fi
